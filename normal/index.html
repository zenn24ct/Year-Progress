<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Year Progress Grid</title>
<style>
  :root{
    --cols: 17;           /* 列数（見た目調整用）*/
    --cell-size: 14px;    /* セルの直径（調整可）*/
    --gap: 6px;           /* セル間の余白 */
    --accent: #22c55e;    /* 過ぎた日（緑） */
    --bg: #0b0b0b;        /* 黒背景（スマホ壁紙風）*/
    --cell-bg: #222;      /* 未過ぎの日の色 */
    --muted: #9ca3af;     /* テキストの色 */
  }

  html,body{
    height:100%;
    margin:0;
    font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Segoe UI", Roboto, "Noto Sans JP", sans-serif;
    background: linear-gradient(180deg,#071014 0%, #071014 55%, #071014 100%);
    color: white;
    -webkit-font-smoothing:antialiased;
  }

  .wrap{
    max-width:980px;
    margin:24px auto;
    padding:20px;
  }

  header{
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
    margin-bottom:18px;
  }

  .title{
    display:flex;
    gap:12px;
    align-items:center;
  }
  h1{
    font-size:20px;
    margin:0;
  }
  .controls{
    display:flex;
    gap:10px;
    align-items:center;
  }

  select, input[type="number"]{
    background:transparent;
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.06);
    padding:8px 10px;
    border-radius:8px;
  }

  .stats{
    margin:12px 0 20px 0;
    display:flex;
    gap:18px;
    align-items:center;
    flex-wrap:wrap;
  }
  .stat{
    font-size:14px;
    color:var(--muted);
  }
  .stat .value{
    font-weight:700;
    color:var(--accent);
    margin-left:8px;
  }

  .phone-mock{
    /* 壁紙風の黒い縦領域 */
    background: radial-gradient(circle at 50% 8%, rgba(255,255,255,0.02), transparent 20%), var(--bg);
    border-radius:34px;
    padding:24px 18px;
    display:flex;
    justify-content:center;
  }

  .grid{
    width:100%;
    max-width:640px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:22px;
    border-radius:18px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    display:grid;
    grid-template-columns: repeat(var(--cols), 1fr);
    gap:var(--gap);
    justify-items:center;
    align-items:center;
  }

  .cell{
    width:var(--cell-size);
    height:var(--cell-size);
    border-radius:50%;
    background: var(--cell-bg);
    transition: transform .15s, background .2s, box-shadow .15s;
    box-shadow: inset 0 -2px 0 rgba(0,0,0,0.4);
    position:relative;
  }
  .cell.past{
    background: var(--accent);
    box-shadow: 0 6px 14px rgba(34,197,94,0.14);
  }
  .cell.today{
    outline: 2px solid rgba(255,255,255,0.06);
    transform: scale(1.12);
    box-shadow: 0 10px 30px rgba(34,197,94,0.18);
  }

  .cell:hover::after{
    content: attr(data-label);
    position: absolute;
    top: -36px;
    left: 50%;
    transform: translateX(-50%);
    white-space:nowrap;
    background: rgba(0,0,0,0.75);
    color: #fff;
    padding:6px 8px;
    font-size:12px;
    border-radius:6px;
    pointer-events:none;
  }

  .footer{
    margin-top:18px;
    display:flex;
    gap:12px;
    align-items:center;
    justify-content:space-between;
  }

  .progressbar {
    height:10px;
    background: rgba(255,255,255,0.05);
    border-radius:999px;
    overflow:hidden;
    flex:1;
  }
  .progressbar > i{
    display:block;
    height:100%;
    width:0%;
    background: linear-gradient(90deg, rgba(34,197,94,0.95), rgba(16,185,129,0.85));
    border-radius:999px;
    transition: width .4s;
  }

  /* responsive */
  @media (max-width:600px){
    :root{ --cols: 8; --cell-size: 12px; --gap:6px; }
    .wrap{ padding:10px; margin:10px; }
    .grid{ padding:14px; border-radius:14px; }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Year progress — 日にちのグリッド</h1>
        <div style="font-size:12px;color:var(--muted)">過ぎた日は緑で表示します</div>
      </div>

      <div class="controls">
        <label style="font-size:13px;color:var(--muted)">年</label>
        <select id="yearSelect"></select>
      </div>
    </header>

    <div class="stats">
      <div class="stat">合計日数: <span id="totalDays" class="value">365</span></div>
      <div class="stat">過ぎた日: <span id="passedDays" class="value">0</span></div>
      <div class="stat">残り日: <span id="remainingDays" class="value">0</span></div>
    </div>

    <div class="phone-mock">
      <div style="width:100%;max-width:420px;">
        <div class="grid" id="grid"></div>

        <div class="footer" style="margin-top:14px;">
          <div class="stat" style="font-size:13px;color:var(--muted)">進捗</div>
          <div class="progressbar" style="margin:0 12px;">
            <i id="bar"></i>
          </div>
          <div style="min-width:88px;text-align:right;color:var(--muted);font-size:13px">
            <div style="font-weight:700;color:var(--accent)" id="percentLabel">0%</div>
            <div style="font-size:11px;color:var(--muted)">完成率</div>
          </div>
        </div>
      </div>
    </div>

  </div>

<script>
(function(){
  const gridEl = document.getElementById('grid');
  const yearSelect = document.getElementById('yearSelect');
  const totalDaysEl = document.getElementById('totalDays');
  const passedDaysEl = document.getElementById('passedDays');
  const remainingDaysEl = document.getElementById('remainingDays');
  const barEl = document.getElementById('bar');
  const percentLabel = document.getElementById('percentLabel');

  // 年セレクトに今から前後数年を入れる
  const now = new Date();
  const currentYear = now.getFullYear();
  for(let y = currentYear - 3; y <= currentYear + 3; y++){
    const opt = document.createElement('option');
    opt.value = y;
    opt.textContent = y;
    if(y === currentYear) opt.selected = true;
    yearSelect.appendChild(opt);
  }

  // ユーティリティ
  function isLeapYear(y){
    return (y % 4 === 0 && y % 100 !== 0) || (y % 400 === 0);
  }
  function dayIndexInYear(date, yearStart){
    // yearStart は Date(YYYY,0,1)
    const msPerDay = 24*60*60*1000;
    // 時刻差の影響を避けるため UTCで算出
    const diff = Date.UTC(date.getFullYear(), date.getMonth(), date.getDate())
               - Date.UTC(yearStart.getFullYear(), yearStart.getMonth(), yearStart.getDate());
    return Math.floor(diff / msPerDay); // 0ベース（Jan1 => 0）
  }

  function renderGridForYear(year){
    gridEl.innerHTML = '';
    const totalDays = isLeapYear(year) ? 366 : 365;
    totalDaysEl.textContent = totalDays;

    // グリッドの列数は CSS の変数で決める。JSからも見ておく
    const cols = getComputedStyle(document.documentElement).getPropertyValue('--cols') || 17;
    gridEl.style.gridTemplateColumns = `repeat(${cols},1fr)`;

    // 年の開始日と終了日
    const start = new Date(Date.UTC(year,0,1));
    const end = new Date(Date.UTC(year,11,31));

    // 今日をその年内で扱う（ページを開いたローカル日付）
    const today = new Date();
    // 判断基準日: the user's local date (not UTC midnight) — so use local date parts
    const localToday = new Date(today.getFullYear(), today.getMonth(), today.getDate());

    let passed = 0;
    // もし localToday が年より前なら passed=0; 年を超えていたら passed=totalDays
    if (localToday < new Date(year,0,1)){
      passed = 0;
    } else if (localToday > new Date(year,11,31)){
      passed = totalDays;
    } else {
      passed = dayIndexInYear(localToday, new Date(year,0,1)) + 1; // inclusive: Jan1 => 1 day passed
      if (passed > totalDays) passed = totalDays;
    }

    for(let i=0;i<totalDays;i++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      const date = new Date(year,0,1 + i); // local date for hover label
      const label = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
      cell.setAttribute('data-label', label);

      if(i < passed) {
        cell.classList.add('past');
      }
      // mark today
      const todayIndex = (localToday >= new Date(year,0,1) && localToday <= new Date(year,11,31))
          ? dayIndexInYear(localToday, new Date(year,0,1))
          : -1;
      if(i === todayIndex) cell.classList.add('today');

      gridEl.appendChild(cell);
    }

    // stats
    passedDaysEl.textContent = passed;
    const remaining = Math.max(0, totalDays - passed);
    remainingDaysEl.textContent = remaining;

    const percent = Math.round((passed / totalDays) * 100);
    percentLabel.textContent = `${percent}%`;
    barEl.style.width = `${percent}%`;
  }

  // 初期描画
  renderGridForYear(Number(yearSelect.value));

  // 年が変わったら再描画
  yearSelect.addEventListener('change', ()=> {
    renderGridForYear(Number(yearSelect.value));
  });

  // 1分ごとに更新（もし日付がまたいだ場合の保険）
  setInterval(()=>{
    renderGridForYear(Number(yearSelect.value));
  }, 60*1000);

})();
</script>
</body>
</html>
